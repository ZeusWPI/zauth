{% extends "base_logged_in.html" %}

{% block content %}

<h1>{{ user.username }}</h1>
{% if user.admin %}
    <p> This user is an admin.
{% else %}
    <p> This is a normal user.
{% endif %}

<div class="container">

    <div class="row">
        <div class="column">
            <h3>
                Update profile info
            </h3>

            <form id='profile-form' action="/users/{{user.id}}" method="POST">
                <input type="hidden" name="_method" value="put"/>

                <label for="username">Username</label>
                <input id="username" name="username" type="text" value="{{ user.username }}" disabled/>

                <label for="password">password</label>
                <input id="password" name="password" type="password"/>

                <label for="full_name">Full Name</label>
                <input id="full_name" name="full_name" type="text" value="{{ user.full_name }}"/>

                <label for="email">Email</label>
                <input id="email" name="email" type="email" value="{{ user.email }}"/>

                <label for="ssh_key">ssh key</label>
                <input id="ssh_key" name="ssh_key" type="text"
                       value="{% match user.ssh_key %}{% when Some with (val) %}{{ val }}{% when None %}{% endmatch %}"/>

                <button id='submit-button' type="submit" disabled>Update</button>
            </form>
        </div>
        <div class="column">
            <h3>
                Set new password
            </h3>
            <p>Coming soon!</p>
        </div>
    </div>
    <script>
        formEquals = function (a, b) {
            return JSON.stringify([...a.entries()]) === JSON.stringify([...b.entries()])
        }

        window.onload = function () {
            let form = document.getElementById('profile-form');
            let initialFormData = new FormData(form);
            let submitButton = document.getElementById('submit-button')

            form.addEventListener('input', function () {
                if (formEquals(initialFormData, new FormData(form))) {
                    submitButton.disabled = true;
                } else {
                    submitButton.disabled = false;
                }
            });
        };
    </script>
</div>{% endblock content %}